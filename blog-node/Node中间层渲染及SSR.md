---
title: 使用 node 做中间层
---

[细说后端模板渲染、客户端渲染、node 中间层、服务器端渲染（ssr）](https://blog.csdn.net/VhWfR2u02Q/article/details/83247493)

前端与后端渲染方式的发展大致经历了这样几个阶段：

1. 后端模板渲染；
2. 客户端渲染；
3. node 中间层；
4. 服务器端渲染（ssr）；

## 1.后端模板渲染，如 express>handlebars / java>jsp / php>smarty

前端与后端最初的渲染方式是后端模板渲染，就是**由后端使用模板引擎渲染好 html 后，返回给前端**，前端再用 js 去操作 dom 或者渲染其他动态的部分。

### 后端模板渲染,这种方式的有这样的几个不足

1. 前后端杂揉在一起，不方便本地开发、本地模拟调试，也不方便自动化测试；
2. 前端被约束在后端开发的模式中，不能充分使用前端的构建生态，开发效率低下；
3. 项目难以管理和维护，也可能会有前后端职责不清的问题；

## 2.客户端渲染，spa

随着前端工程化与前后端分离的发展，以及前端组件化技术的出现，如 react、vue 等，客户端渲染已经慢慢变成了主要的开发方式了。

**与后端模板渲染刚好相反**，客户端渲染的页面渲染都是在客户端进行，后端不负责任何的渲染，只管数据交互。

### 客户端渲染与前后端分离有很大的好处

1. 前端独立出来，可以充分使用**前端生态**的强大功能；
2. 更好的管理代码，**更有效率的开发、调试、测试**；
3. 前后端代码解耦之后，**能更好的扩展、重构**。

### 客户端渲染，这种方式也有一些不足

1. 首屏**加载缓慢**，因为要等 js 加载完毕后，才能进行渲染；
   1. 通过异步组件来实现，切分首页 js 代码；
2. SEO 不友好，**因为 html 中几乎没有可用的信息**；

## 3.node 中间层

为了解决客户端渲染的不足，便出现了 **node 中间层**的理念。

1. 传统的 B/S 架构中，是 `浏览器->后端服务器->浏览器`，上文所讲的都是这种架构。
2. 而加入了 node 中间层之后，就变成 `浏览器->node->后端服务器->node->浏览器`。

一个典型的 node 中间层应用就是：

1. 后端提供数据；
2. node 层**渲染模板**；
3. 前端动态渲染。

### node 中间层，达到了以下的目的

1. 保留后端**模板渲染**、**首屏快速响应**、SEO 友好；
2. 保留**前端后分离**、客户端渲染的功能（首屏服务器端渲染、其他客户端渲染）；

### 但这种方式也有一些不足

1. 增加了一个中间层，应用**性能有所降低**；
2. 增加了架构的复杂度、不稳定性，**降低应用的安全性**；
3. 对开发人员要求高了很多；

## 4.服务器端渲染（ssr）

大部分情况下，**服务器端渲染（ssr）与 node 中间层是同一个概念**。

服务器端渲染（ssr）一般特指，在上文讲到的 **node 中间层基础上**，加上前端组件化技术在服务器上的渲染，特别是 react 和 vue。

**前端组件化**能够在服务器端渲染，比如 next.js、nuxt.js，一般这些框架都会有一些目录结构、书写方式、组件集成、项目构建的要求，**自定义属性可能不是很强**。

以 next.js 为例，

1. 整个应用中是**没有 html 文件**的，
2. 所有的响应 html **都是 node 动态渲染的**，包括里面的元信息、css、js 路径等。
3. 渲染过程中， next.js 会根据路由，**将首页所有的组件渲染成 html**，
4. **余下的页面保留原生组件的格式，在客户端渲染**。
